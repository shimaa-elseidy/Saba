import{a as H}from"./chunk-QHJLIQUI.js";import{a as B}from"./chunk-IP3FY2TA.js";import{B as $,c as M,e as s,f as T,g as D,l as q,m as k,p as j,s as V,t as z,u as U,v as R,z as G}from"./chunk-5ZW25HYA.js";import"./chunk-CU2TEK6Q.js";import{g as A}from"./chunk-JKYV32XC.js";import"./chunk-SLPUACWX.js";import"./chunk-MMGRQEJU.js";import"./chunk-Q5MV2RZV.js";import{l as P,m as O}from"./chunk-EJ3EEOXZ.js";import{Cb as d,Db as p,Kb as i,Lb as n,Mb as v,Vb as F,Wb as _,eb as a,ec as r,fc as N,kb as g,qb as E,vb as c}from"./chunk-FHROAHAP.js";import"./chunk-WWX6BADO.js";function L(e,m){if(e&1&&(i(0,"option",33),r(1),n()),e&2){let o=m.$implicit;d("value",o.userID),a(),N(o.name)}}function Y(e,m){e&1&&(i(0,"div"),r(1,"Username is required"),n())}function J(e,m){if(e&1&&(i(0,"div",34),c(1,Y,2,0,"div",31),n()),e&2){let o,l=_();a(),d("ngIf",(o=l.invoiceForm.get("username"))==null||o.errors==null?null:o.errors.required)}}function K(e,m){e&1&&(i(0,"div"),r(1,"Invoice number is required"),n())}function Q(e,m){if(e&1&&(i(0,"div",34),c(1,K,2,0,"div",31),n()),e&2){let o,l=_();a(),d("ngIf",(o=l.invoiceForm.get("invoiceNumber"))==null||o.errors==null?null:o.errors.required)}}function W(e,m){e&1&&(i(0,"div"),r(1,"Email is required"),n())}function X(e,m){e&1&&(i(0,"div"),r(1,"Enter a valid email"),n())}function Z(e,m){if(e&1&&(i(0,"div",34),c(1,W,2,0,"div",31)(2,X,2,0,"div",31),n()),e&2){let o,l,t=_();a(),d("ngIf",(o=t.invoiceForm.get("userEmail"))==null||o.errors==null?null:o.errors.required),a(),d("ngIf",(l=t.invoiceForm.get("userEmail"))==null||l.errors==null?null:l.errors.email)}}function ee(e,m){e&1&&(i(0,"div"),r(1,"Total amount is required"),n())}function te(e,m){e&1&&(i(0,"div"),r(1,"Enter a valid number"),n())}function ne(e,m){e&1&&(i(0,"div"),r(1,"Amount must be greater than 0"),n())}function ie(e,m){if(e&1&&(i(0,"div",34),c(1,ee,2,0,"div",31)(2,te,2,0,"div",31)(3,ne,2,0,"div",31),n()),e&2){let o,l,t,u=_();a(),d("ngIf",(o=u.invoiceForm.get("totalAmount"))==null||o.errors==null?null:o.errors.required),a(),d("ngIf",(l=u.invoiceForm.get("totalAmount"))==null||l.errors==null?null:l.errors.pattern),a(),d("ngIf",(t=u.invoiceForm.get("totalAmount"))==null||t.errors==null?null:t.errors.min)}}function oe(e,m){e&1&&(i(0,"div"),r(1,"Tour name is required"),n())}function re(e,m){if(e&1&&(i(0,"div",34),c(1,oe,2,0,"div",31),n()),e&2){let o,l=_();a(),d("ngIf",(o=l.invoiceForm.get("tourName"))==null||o.errors==null?null:o.errors.required)}}function le(e,m){e&1&&(i(0,"div"),r(1,"Issue date is required"),n())}function ae(e,m){e&1&&(i(0,"div"),r(1,"Issue date cannot be before today"),n())}function de(e,m){if(e&1&&(i(0,"div",34),c(1,le,2,0,"div",31)(2,ae,2,0,"div",31),n()),e&2){let o,l,t=_();a(),d("ngIf",(o=t.invoiceForm.get("issueDate"))==null||o.errors==null?null:o.errors.required),a(),d("ngIf",(l=t.invoiceForm.get("issueDate"))==null||l.errors==null?null:l.errors.beforeToday)}}function me(e,m){e&1&&(i(0,"div"),r(1,"Due date is required"),n())}function ce(e,m){e&1&&(i(0,"div"),r(1,"Due date must be after issue date"),n())}function se(e,m){if(e&1&&(i(0,"div",34),c(1,me,2,0,"div",31)(2,ce,2,0,"div",31),n()),e&2){let o,l,t=_();a(),d("ngIf",(o=t.invoiceForm.get("dueDate"))==null||o.errors==null?null:o.errors.required),a(),d("ngIf",(l=t.invoiceForm.get("dueDate"))==null||l.errors==null?null:l.errors.dueBeforeIssue)}}function ue(e,m){e&1&&(i(0,"div"),r(1,"Required"),n())}function pe(e,m){e&1&&(i(0,"div"),r(1,"Only positive numbers allowed"),n())}function ve(e,m){if(e&1&&(i(0,"div",34),c(1,ue,2,0,"div",31)(2,pe,2,0,"div",31),n()),e&2){let o,l,t=_();a(),d("ngIf",(o=t.invoiceForm.get("adults"))==null||o.errors==null?null:o.errors.required),a(),d("ngIf",(l=t.invoiceForm.get("adults"))==null||l.errors==null?null:l.errors.pattern)}}function _e(e,m){e&1&&(i(0,"div"),r(1,"Required"),n())}function fe(e,m){e&1&&(i(0,"div"),r(1,"Only positive numbers allowed"),n())}function ge(e,m){if(e&1&&(i(0,"div",34),c(1,_e,2,0,"div",31)(2,fe,2,0,"div",31),n()),e&2){let o,l,t=_();a(),d("ngIf",(o=t.invoiceForm.get("children"))==null||o.errors==null?null:o.errors.required),a(),d("ngIf",(l=t.invoiceForm.get("children"))==null||l.errors==null?null:l.errors.pattern)}}function xe(e,m){e&1&&(i(0,"div"),r(1,"Required"),n())}function be(e,m){e&1&&(i(0,"div"),r(1,"Only positive numbers allowed"),n())}function he(e,m){if(e&1&&(i(0,"div",34),c(1,xe,2,0,"div",31)(2,be,2,0,"div",31),n()),e&2){let o,l,t=_();a(),d("ngIf",(o=t.invoiceForm.get("infants"))==null||o.errors==null?null:o.errors.required),a(),d("ngIf",(l=t.invoiceForm.get("infants"))==null||l.errors==null?null:l.errors.pattern)}}function Ce(e,m){e&1&&(i(0,"span"),r(1,"Create Invoice"),n())}function Ie(e,m){e&1&&v(0,"span",35)}var Oe=(()=>{class e{constructor(o,l,t,u){this.fb=o,this.invoiceService=l,this.toastr=t,this.router=u,this.isSubmitting=!1,this.users=[],this.invoiceForm=this.fb.group({username:["",s.required],userEmail:["",[s.required,s.email]],tourName:["",s.required],description:[""],invoiceNumber:[,s.required],totalAmount:["",[s.required,s.pattern("^[0-9]+(\\.[0-9]{1,2})?$"),s.min(1)]],issueDate:["",s.required],dueDate:["",s.required],adults:["",[s.required,s.pattern("^[0-9]+$")]],children:["",[s.required,s.pattern("^[0-9]+$")]],infants:["",[s.required,s.pattern("^[0-9]+$")]]})}ngOnInit(){this.getUsers(),this.setDateValidators()}getUsers(){this.invoiceService.getAllUsers().subscribe({next:o=>{this.users=o},error:o=>{console.error("Failed to load users",o)}})}setDateValidators(){let o=new Date;o.setHours(0,0,0,0),this.invoiceForm.get("issueDate")?.valueChanges.subscribe(l=>{let t=new Date(l);t.setHours(0,0,0,0),this.invoiceForm.get("dueDate")?.setValidators([s.required,u=>{let f=new Date(u.value);return f.setHours(0,0,0,0),f>t?null:{dueBeforeIssue:!0}}]),this.invoiceForm.get("dueDate")?.updateValueAndValidity()}),this.invoiceForm.get("issueDate")?.setValidators([s.required,l=>{let t=new Date(l.value);return t.setHours(0,0,0,0),t>=o?null:{beforeToday:!0}}])}onSubmit(){if(this.invoiceForm.valid){this.isSubmitting=!0;let o=this.users.find(t=>t.userID===this.invoiceForm.value.username),l={userEmail:o?.email,userId:o?.userID,tourId:this.invoiceForm.value.tourName==="tour1"?1:2,invoiceNumber:this.invoiceForm.value.invoiceNumber,issueDate:this.invoiceForm.value.issueDate,dueDate:this.invoiceForm.value.dueDate,totalAmount:+this.invoiceForm.value.totalAmount,adults:+this.invoiceForm.value.adults,children:+this.invoiceForm.value.children,infants:+this.invoiceForm.value.infants,description:this.invoiceForm.value.description||""};this.invoiceService.createInvoice(l).subscribe({next:t=>{console.log("Invoice Created:",t),this.toastr.success("Invoice added successfully"),this.invoiceForm.reset(),setTimeout(()=>{this.router.navigate(["/dashboard/invoices"])},1500)},error:t=>{console.error("Error creating invoice:",t),this.toastr.error("Failed to create invoice"),this.isSubmitting=!1},complete:()=>{this.isSubmitting=!1}})}else Object.keys(this.invoiceForm.controls).forEach(o=>{this.invoiceForm.get(o)?.markAsTouched()}),console.warn("Form is invalid"),this.toastr.warning("Please fill all required fields correctly")}static{this.\u0275fac=function(l){return new(l||e)(g(G),g(H),g(B),g(A))}}static{this.\u0275cmp=E({type:e,selectors:[["app-add-new-invoice"]],decls:98,vars:35,consts:[[1,"page-container","animate__animated","animate__fadeIn"],[1,"invoice-container","animate__animated","animate__zoomIn"],[1,"form-header","animate__animated","animate__fadeInDown"],[3,"ngSubmit","formGroup"],[1,"form-grid"],[1,"form-group","animate__animated","animate__fadeInLeft"],[1,"required"],["formControlName","username",1,"form-control"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","error",4,"ngIf"],[1,"form-group","animate__animated","animate__fadeInRight"],["type","text","formControlName","invoiceNumber","placeholder","Type Invoice...",1,"form-control"],["type","email","formControlName","userEmail","placeholder","Type email address...",1,"form-control"],["type","text","formControlName","totalAmount","placeholder","Total Amount...",1,"form-control"],["formControlName","tourName",1,"form-control"],["value","tour1"],["value","tour2"],["type","date","formControlName","issueDate",1,"form-control"],["type","date","formControlName","dueDate",1,"form-control"],[1,"form-group","description","animate__animated","animate__fadeInUp"],["formControlName","description","placeholder","Description...",1,"form-control"],[1,"form-group","guests","animate__animated","animate__fadeInUp",2,"grid-column","span 2"],[1,"guest-inputs"],[1,"guest-input"],["type","number","formControlName","adults","placeholder","Ad",1,"form-control"],["type","number","formControlName","children","placeholder","Ch",1,"form-control"],["type","number","formControlName","infants","placeholder","In",1,"form-control"],[1,"buttons","animate__animated","animate__fadeInUp"],["type","button","routerLink","/dashboard/invoices",1,"cancel"],["type","submit",1,"create",3,"disabled"],[4,"ngIf"],["class","spinner",4,"ngIf"],[3,"value"],[1,"error"],[1,"spinner"]],template:function(l,t){if(l&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),r(4,"Create New Invoice"),n(),i(5,"p"),r(6,"Fill in the details to create a new invoice"),n()(),i(7,"form",3),F("ngSubmit",function(){return t.onSubmit()}),i(8,"div",4)(9,"div",5)(10,"label"),r(11,"Username "),i(12,"span",6),r(13,"*"),n()(),i(14,"select",7)(15,"option",8),r(16,"Select user..."),n(),c(17,L,2,2,"option",9),n(),c(18,J,2,1,"div",10),n(),i(19,"div",11)(20,"label"),r(21,"Invoice Number "),i(22,"span",6),r(23,"*"),n()(),v(24,"input",12),c(25,Q,2,1,"div",10),n(),i(26,"div",5)(27,"label"),r(28,"Email Address "),i(29,"span",6),r(30,"*"),n()(),v(31,"input",13),c(32,Z,3,2,"div",10),n(),i(33,"div",11)(34,"label"),r(35,"Total Amount "),i(36,"span",6),r(37,"*"),n()(),v(38,"input",14),c(39,ie,4,3,"div",10),n(),i(40,"div",5)(41,"label"),r(42,"Tour Name "),i(43,"span",6),r(44,"*"),n()(),i(45,"select",15)(46,"option",8),r(47,"Select tour item..."),n(),i(48,"option",16),r(49,"Tour 1"),n(),i(50,"option",17),r(51,"Tour 2"),n()(),c(52,re,2,1,"div",10),n(),i(53,"div",11)(54,"label"),r(55,"Issue Date "),i(56,"span",6),r(57,"*"),n()(),v(58,"input",18),c(59,de,3,2,"div",10),n(),i(60,"div",5)(61,"label"),r(62,"Due Date "),i(63,"span",6),r(64,"*"),n()(),v(65,"input",19),c(66,se,3,2,"div",10),n(),i(67,"div",20)(68,"label"),r(69,"Description"),n(),v(70,"textarea",21),n(),i(71,"div",22)(72,"label"),r(73,"Guests Capability "),i(74,"span",6),r(75,"*"),n()(),i(76,"div",23)(77,"div",24)(78,"label"),r(79,"Adult"),n(),v(80,"input",25),c(81,ve,3,2,"div",10),n(),i(82,"div",24)(83,"label"),r(84,"Children"),n(),v(85,"input",26),c(86,ge,3,2,"div",10),n(),i(87,"div",24)(88,"label"),r(89,"Infant"),n(),v(90,"input",27),c(91,he,3,2,"div",10),n()()()(),i(92,"div",28)(93,"button",29),r(94,"Cancel"),n(),i(95,"button",30),c(96,Ce,2,0,"span",31)(97,Ie,1,0,"span",32),n()()()()()),l&2){let u,f,x,b,h,C,I,y,S,w;a(7),d("formGroup",t.invoiceForm),a(2),p("animation-delay","0.1s"),a(8),d("ngForOf",t.users),a(),d("ngIf",((u=t.invoiceForm.get("username"))==null?null:u.errors)&&((u=t.invoiceForm.get("username"))==null?null:u.touched)),a(),p("animation-delay","0.1s"),a(6),d("ngIf",((f=t.invoiceForm.get("invoiceNumber"))==null?null:f.errors)&&((f=t.invoiceForm.get("invoiceNumber"))==null?null:f.touched)),a(),p("animation-delay","0.2s"),a(6),d("ngIf",((x=t.invoiceForm.get("userEmail"))==null?null:x.errors)&&((x=t.invoiceForm.get("userEmail"))==null?null:x.touched)),a(),p("animation-delay","0.2s"),a(6),d("ngIf",((b=t.invoiceForm.get("totalAmount"))==null?null:b.errors)&&((b=t.invoiceForm.get("totalAmount"))==null?null:b.touched)),a(),p("animation-delay","0.3s"),a(12),d("ngIf",((h=t.invoiceForm.get("tourName"))==null?null:h.errors)&&((h=t.invoiceForm.get("tourName"))==null?null:h.touched)),a(),p("animation-delay","0.3s"),a(6),d("ngIf",((C=t.invoiceForm.get("issueDate"))==null?null:C.errors)&&((C=t.invoiceForm.get("issueDate"))==null?null:C.touched)),a(),p("animation-delay","0.4s"),a(6),d("ngIf",((I=t.invoiceForm.get("dueDate"))==null?null:I.errors)&&((I=t.invoiceForm.get("dueDate"))==null?null:I.touched)),a(),p("animation-delay","0.5s"),a(4),p("animation-delay","0.6s"),a(10),d("ngIf",((y=t.invoiceForm.get("adults"))==null?null:y.errors)&&((y=t.invoiceForm.get("adults"))==null?null:y.touched)),a(5),d("ngIf",((S=t.invoiceForm.get("children"))==null?null:S.errors)&&((S=t.invoiceForm.get("children"))==null?null:S.touched)),a(5),d("ngIf",((w=t.invoiceForm.get("infants"))==null?null:w.errors)&&((w=t.invoiceForm.get("infants"))==null?null:w.touched)),a(),p("animation-delay","0.7s"),a(3),d("disabled",t.isSubmitting||!t.invoiceForm.valid),a(),d("ngIf",!t.isSubmitting),a(),d("ngIf",t.isSubmitting)}},dependencies:[$,q,U,R,M,k,z,T,D,j,V,O,P],styles:[`@import"https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css";@keyframes _ngcontent-%COMP%_pulse{0%{transform:scale(1);box-shadow:0 4px 6px #2d60ff4d}50%{transform:scale(1.03);box-shadow:0 6px 12px #2d60ff80}to{transform:scale(1);box-shadow:0 4px 6px #2d60ff4d}}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.page-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:calc(100vh - 100px);padding:20px;background-color:#f5f7facc}.invoice-container[_ngcontent-%COMP%]{background:#fff;padding:30px;border-radius:12px;box-shadow:0 8px 30px #0000001a;max-width:900px;width:100%;margin:auto;transition:all .3s ease}.form-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:30px;padding-bottom:20px;border-bottom:1px solid #eaeaea}.form-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#2d60ff;font-weight:700;margin-bottom:10px}.form-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6c757d;font-size:16px}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:25px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-bottom:5px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;font-size:15px;margin-bottom:8px;color:#495057}.required[_ngcontent-%COMP%]{color:#dc3545}.form-control[_ngcontent-%COMP%]{width:100%;padding:12px;border:1px solid #ddd;border-radius:8px;font-size:15px;transition:all .3s ease}.form-control[_ngcontent-%COMP%]:focus{border-color:#2d60ff;box-shadow:0 0 0 3px #2d60ff40;outline:none}.form-control[_ngcontent-%COMP%]::placeholder{color:#8ba3cb;font-size:14px;font-weight:400}select.form-control[_ngcontent-%COMP%]{appearance:none;background-image:url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%232d60ff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");background-repeat:no-repeat;background-position:right 12px center;background-size:16px;padding-right:40px}textarea.form-control[_ngcontent-%COMP%]{min-height:120px;resize:vertical}.description[_ngcontent-%COMP%]{grid-column:span 2}.guest-inputs[_ngcontent-%COMP%]{display:flex;gap:20px;justify-content:space-between}.guest-input[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;background-color:#f8f9fa;padding:15px;border-radius:8px;transition:all .3s ease}.guest-input[_ngcontent-%COMP%]:hover{background-color:#f0f2f5;transform:translateY(-2px)}.guest-input[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-bottom:8px;text-align:center;font-weight:600;color:#2d60ff}.guest-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;text-align:center;font-size:16px;font-weight:500}.buttons[_ngcontent-%COMP%]{margin-top:30px;display:flex;justify-content:flex-end;gap:15px}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:12px 25px;border:none;border-radius:8px;cursor:pointer;font-size:16px;font-weight:600;transition:all .3s ease}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.buttons[_ngcontent-%COMP%]   .create[_ngcontent-%COMP%]{background:#2d60ff;color:#fff;box-shadow:0 4px 6px #2d60ff4d}.buttons[_ngcontent-%COMP%]   .create[_ngcontent-%COMP%]:hover{background:#1a4ad9;box-shadow:0 6px 12px #2d60ff66}.buttons[_ngcontent-%COMP%]   .cancel[_ngcontent-%COMP%]{background:#f0f0f0;color:#495057}.buttons[_ngcontent-%COMP%]   .cancel[_ngcontent-%COMP%]:hover{background:#e2e2e2}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed;transform:none}.spinner[_ngcontent-%COMP%]{display:inline-block;width:20px;height:20px;border:3px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:_ngcontent-%COMP%_spin 1s ease-in-out infinite}.error[_ngcontent-%COMP%]{color:#dc3545;font-size:13px;margin-top:6px;animation:fadeIn .3s ease}@media (max-width: 768px){.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:15px}.description[_ngcontent-%COMP%]{grid-column:span 1}.guest-inputs[_ngcontent-%COMP%]{flex-direction:column;gap:15px}.buttons[_ngcontent-%COMP%]{flex-direction:column-reverse;gap:10px}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}`]})}}return e})();export{Oe as AddNewInvoiceComponent};
