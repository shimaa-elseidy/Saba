import{a as Q}from"./chunk-OMXRSK2X.js";import{a as D}from"./chunk-Z55WRCWW.js";import{a as T}from"./chunk-M5QVVNU3.js";import{e as X}from"./chunk-QWEIAW4D.js";import"./chunk-5OQI2EGS.js";import{a as A}from"./chunk-AXM7N3CA.js";import"./chunk-CU2TEK6Q.js";import{b as q,f as Z,g as J,h as K,l as N}from"./chunk-JKYV32XC.js";import"./chunk-SLPUACWX.js";import"./chunk-MMGRQEJU.js";import"./chunk-Q5MV2RZV.js";import{k as H,l as E,m as M,s as Y,w as P}from"./chunk-EJ3EEOXZ.js";import{A as j,Bb as W,C as y,Cb as c,Eb as G,G as k,Kb as o,Lb as r,Mb as p,Qb as C,T as S,Vb as m,Wb as f,_a as V,a as w,cb as B,eb as a,ec as g,fc as x,gc as z,kb as b,m as I,na as _,oa as u,pc as $,qb as v,rc as F,tc as L,vb as h,ya as R}from"./chunk-FHROAHAP.js";import"./chunk-WWX6BADO.js";var ct=(e,d)=>({collapsed:e,open:d});function lt(e,d){if(e&1){let t=C();o(0,"button",11),m("click",function(){_(t);let n=f();return u(n.toggleSidebar())}),p(1,"i",12),r()}}function dt(e,d){if(e&1){let t=C();o(0,"button",13),m("click",function(){_(t);let n=f();return u(n.toggleSidebar())}),p(1,"i",14),r()}}function pt(e,d){e&1&&(o(0,"div",15),p(1,"img",16),r())}function gt(e,d){e&1&&(o(0,"div",15),p(1,"img",17),r())}function ht(e,d){if(e&1&&(o(0,"span",22),g(1),r()),e&2){let t=f().$implicit;a(),x(t.label)}}function mt(e,d){if(e&1){let t=C();o(0,"li",18)(1,"a",19),m("click",function(){let n=_(t).$implicit,l=f();return u(l.setActiveMenuAndTitle(n))}),p(2,"i",20),h(3,ht,2,1,"span",21),r()()}if(e&2){let t=d.$implicit,i=f();G("active",i.isActive(t.route)),a(),c("routerLink",t.route)("title",i.isCollapsed?t.label:""),W("aria-label",t.label),a(),c("ngClass",t.icon),a(),c("ngIf",!i.isCollapsed)}}function ft(e,d){e&1&&(o(0,"span"),g(1,"Back to Homepage"),r())}function bt(e,d){e&1&&p(0,"i",12)}var nt=(()=>{class e{constructor(t,i,n,l){this.router=t,this.authService=i,this.settingService=n,this.dashboardService=l,this.titleChange=new R,this.collapseSidebar=new R,this.collapsed=!1,this.isCollapsed=window.innerWidth<=768,this.isOpen=!1,this.userRole=null,this.userRoleName="",this.allMenuItems=[{label:"Dashboard",icon:"bi-speedometer2",route:"/dashboard",roles:[1]},{label:"User Management",icon:"bi-person",route:"/dashboard/user-management",roles:[1]},{label:"All Tours",icon:"bi-list-ul",route:"/dashboard/myToors",roles:[1]},{label:"All Booking",icon:"bi-calendar-check",route:"/dashboard/myBooking",roles:[1]},{label:"My Booking",icon:"bi-calendar-check",route:"/dashboard/myBookingUser",roles:[3]},{label:"All Comments",icon:"bi-chat-left-text",route:"/dashboard/comments",roles:[1]},{label:"My Comments",icon:"bi-chat-left-text",route:"/dashboard/myComments",roles:[3]},{label:"All Wallet",icon:"bi-wallet2",route:"/dashboard/withdrawals",roles:[1]},{label:"My Wallet",icon:"bi-wallet2",route:"/dashboard/userWithdrawal",roles:[1]},{label:"Invoices",icon:"bi-receipt",route:"/dashboard/invoices",roles:[1]},{label:"My Invoices",icon:"bi-receipt",route:"/dashboard/userInvoice",roles:[2,3]},{label:"Blogs",icon:"bi-journal-richtext",route:"/dashboard/blogs",roles:[1]},{label:"Ads Manager",icon:"bi-megaphone",route:"/dashboard/adsManager",roles:[1]},{label:"Design trips",icon:"bi-megaphone",route:"/dashboard/design-trips",roles:[1]},{label:"Chat",icon:"bi-chat",route:"/dashboard/chat"}],this.specialRouteTitles={"/dashboard/add-new-blog":"Add New Blog","/dashboard/add-new-tour":"Add New Tour","/dashboard/create-new-user":"Create New User","/dashboard/add-new-booking":"Add New Booking","/dashboard/add-new-invoice":"Add New Invoice"},this.menuItems=[],this.userName="",this.isDropdownOpen=!1,this.isNotificationOpen=!1,this.recentActivities=[],this.unreadNotificationsCount=0,this.showNotifications=!1,this.DEFAULT_PROFILE_IMAGE="assets/WhatsApp Image 2025-04-24 at 14.52.36_a522ea2e.jpg",this.subscription=new w,this.showUserMenu=!1;let s=this.authService.getUserData?.();s?(this.userName=s.name||"User",this.profileImage=this.getSafeImageUrl(s.profilePicture),this.userRole=Number(s.roleId),this.userRoleName=s.roleName?String(s.roleName):s.roleId===1?"Admin":s.roleId===2?"User":"",this.userRole===1?this.showNotifications=!0:this.userRole===2?this.showNotifications=!1:this.showNotifications=["manager","admin","supervisor"].some(O=>this.userRoleName.toLowerCase().includes(O))):this.profileImage=this.DEFAULT_PROFILE_IMAGE,this.subscription.add(this.settingService.profileImage$?.subscribe(O=>{this.profileImage=this.getSafeImageUrl(O),localStorage.setItem("profileImage",O)}))}ngOnInit(){this.isCollapsed=!0;let t=localStorage.getItem("profileImage");this.profileImage=this.getSafeImageUrl(t),this.userRole=this.authService.getUserRole(),this.filterMenuItems(),this.userRole===1&&this.setTitleFromCurrentRoute(),this.router.events.pipe(j(i=>i instanceof q)).subscribe(()=>{this.userRole===1&&this.setTitleFromCurrentRoute()}),this.showNotifications&&this.fetchRecentActivities()}setTitleFromCurrentRoute(){let t=this.router.url;if(t.includes("/dashboard/add-new-blog/")){this.titleChange.emit("Edit Blog");return}for(let l in this.specialRouteTitles)if(t.startsWith(l)){this.titleChange.emit(this.specialRouteTitles[l]);return}for(let l of this.allMenuItems)if(t===l.route){this.titleChange.emit(l.label);return}let i=t.split("/"),n=i[i.length-1];if(n){let l=n.split("-").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" ");this.titleChange.emit(l)}else this.titleChange.emit("Dashboard")}filterMenuItems(){this.menuItems=this.allMenuItems.filter(t=>t.roles?t.roles.includes(this.userRole||0):!0)}setActiveMenuAndTitle(t){this.titleChange.emit(t.label),window.innerWidth<=768&&(this.isOpen=!1)}sendTitle(t){this.titleChange.emit(t)}toggleSidebar(){window.innerWidth<=768?this.isOpen=!this.isOpen:this.isCollapsed=!this.isCollapsed}collapseSidebarBtn(){this.collapseSidebar.emit()}isActive(t){return t==="/dashboard"?this.router.url==="/dashboard":this.router.url===t||this.router.url.startsWith(t+"/")}onResize(t){this.isCollapsed=window.innerWidth<=768,this.isOpen=!1}goHome(){window.location.href="/"}getSafeImageUrl(t){return t?/^[a-zA-Z0-9+/=]{100,}$/.test(t)?`data:image/png;base64,${t}`:t.startsWith("http://")||t.startsWith("https://")?t:this.DEFAULT_PROFILE_IMAGE:this.DEFAULT_PROFILE_IMAGE}resetToDefaultImage(){this.profileImage=this.DEFAULT_PROFILE_IMAGE,localStorage.removeItem("profileImage")}fetchRecentActivities(){this.dashboardService.getRecentActivities().pipe(k(1),S(t=>{console.log("Fetching recent activities...",t)}),y(t=>I([]))).subscribe(t=>{this.recentActivities=t.sort((i,n)=>new Date(n.date).getTime()-new Date(i.date).getTime()).slice(0,4),this.unreadNotificationsCount=this.recentActivities.length})}toggleNotifications(){this.showNotifications&&(this.isNotificationOpen=!this.isNotificationOpen,this.isNotificationOpen&&(this.unreadNotificationsCount=0))}toggleDropdown(){this.isDropdownOpen=!this.isDropdownOpen}toggleUserMenu(){this.showUserMenu=!this.showUserMenu}logOut(){this.authService.logout()}handleImageError(t){let i=t.target;i.src=this.DEFAULT_PROFILE_IMAGE}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(i){return new(i||e)(b(J),b(T),b(D),b(A))}}static{this.\u0275cmp=v({type:e,selectors:[["app-sidebar"]],hostBindings:function(i,n){i&1&&m("resize",function(s){return n.onResize(s)},!1,B)},inputs:{collapsed:"collapsed"},outputs:{titleChange:"titleChange",collapseSidebar:"collapseSidebar"},decls:13,vars:12,consts:[["class","toggle-btn","aria-label","Expand sidebar",3,"click",4,"ngIf"],[1,"sidebar",3,"ngClass"],["class","toggle-btn-out","aria-label","Collapse sidebar",3,"click",4,"ngIf"],["class","sidebar-logo",4,"ngIf"],[1,"sidebar-nav"],[1,"nav-list"],["class","nav-item",3,"active",4,"ngFor","ngForOf"],["routerLink","/",1,"back-to-home",3,"title"],[1,"bi","bi-house-door-fill"],[4,"ngIf"],["class","bi bi-chevron-double-right",4,"ngIf"],["aria-label","Expand sidebar",1,"toggle-btn",3,"click"],[1,"bi","bi-chevron-double-right"],["aria-label","Collapse sidebar",1,"toggle-btn-out",3,"click"],[1,"bi","bi-chevron-double-left"],[1,"sidebar-logo"],["src","./assets/sabba.png","alt","logo",1,"w-100"],["src","./assets/favicon.ico.ico","alt","logo"],[1,"nav-item"],[1,"nav-link",3,"click","routerLink","title"],[1,"bi","nav-icon",3,"ngClass"],["class","nav-label",4,"ngIf"],[1,"nav-label"]],template:function(i,n){i&1&&(o(0,"div"),h(1,lt,2,0,"button",0),r(),o(2,"aside",1),h(3,dt,2,0,"button",2)(4,pt,2,0,"div",3)(5,gt,2,0,"div",3),o(6,"nav",4)(7,"ul",5),h(8,mt,4,7,"li",6),r()(),o(9,"a",7),p(10,"i",8),h(11,ft,2,0,"span",9)(12,bt,1,0,"i",10),r()()),i&2&&(a(),c("ngIf",n.isCollapsed),a(),c("ngClass",$(9,ct,n.isCollapsed,n.isOpen)),a(),c("ngIf",!n.isCollapsed),a(),c("ngIf",!n.isCollapsed),a(),c("ngIf",n.isCollapsed),a(3),c("ngForOf",n.menuItems),a(),c("title",n.isCollapsed?"Back to Homepage":""),a(2),c("ngIf",!n.isCollapsed),a(),c("ngIf",!n.isCollapsed))},dependencies:[P,H,E,M,N,K],styles:['.sidebar[_ngcontent-%COMP%]{width:240px;min-height:100vh;position:fixed;left:0;top:0;background:#fff;border-right:1px solid rgba(0,0,0,.1);padding:0;z-index:1101;display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden;height:100vh;max-height:100vh}.sidebar[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex-shrink:0}.sidebar[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.sidebar[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#0003;border-radius:8px}.sidebar[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#0000001a}.sidebar.collapsed[_ngcontent-%COMP%]{width:80px;transition:all .35s cubic-bezier(.4,0,.2,1)}.sidebar.collapsed[_ngcontent-%COMP%]   .sidebar-logo[_ngcontent-%COMP%]{padding:12px 12px 8px}.sidebar.collapsed[_ngcontent-%COMP%]   .sidebar-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:12px;margin-bottom:8px}.sidebar.collapsed[_ngcontent-%COMP%]   .nav-label[_ngcontent-%COMP%], .sidebar.collapsed[_ngcontent-%COMP%]   .item-text[_ngcontent-%COMP%]{opacity:0;transform:translate(-10px);transition:opacity .2s ease,transform .2s ease;will-change:opacity,transform}.sidebar.collapsed[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{justify-content:center;margin:0 12px 2px}.sidebar.collapsed[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{justify-content:center;padding:10px 8px;min-height:40px;display:flex;align-items:center}.sidebar.collapsed[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]{margin:0!important;font-size:20px;text-align:center;width:20px}.sidebar.collapsed[_ngcontent-%COMP%]   .nav-list[_ngcontent-%COMP%]{gap:1px;padding:4px 0}.sidebar.collapsed[_ngcontent-%COMP%]   .back-to-home[_ngcontent-%COMP%]{margin:12px 12px 16px;align-self:center;width:calc(100% - 24px);padding:12px;justify-content:center;min-height:40px}.sidebar.collapsed[_ngcontent-%COMP%]   .back-to-home[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}.sidebar.collapsed[_ngcontent-%COMP%]   .back-to-home[_ngcontent-%COMP%]   .bi-house-door-fill[_ngcontent-%COMP%]{font-size:20px;margin:0}.sidebar.collapsed[_ngcontent-%COMP%]   .back-to-home[_ngcontent-%COMP%]   .bi-chevron-double-right[_ngcontent-%COMP%]{display:none}.toggle-btn[_ngcontent-%COMP%]{position:fixed;top:4%;left:70px;transform:translateY(-50%);background:transparent;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:1102;transition:all .3s cubic-bezier(.25,.8,.25,1);border:1px solid transparent}.toggle-btn[_ngcontent-%COMP%]:hover{transform:translateY(-50%) scale(1.1)}.toggle-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#2563eb;font-size:14px;transition:transform .3s ease}.toggle-btn[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{transform:scale(1.1)}.toggle-btn-out[_ngcontent-%COMP%]{position:fixed;top:4%;left:232px;transform:translateY(-50%);background:#fff;border:none;width:32px;height:20px;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:1102;transition:all .3s ease;border:1px solid transparent}.toggle-btn-out[_ngcontent-%COMP%]:hover{transform:translateY(-50%) scale(1.1)}.toggle-btn-out[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#2563eb;font-size:14px;transition:transform .3s ease}.toggle-btn-out[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{transform:scale(1.1)}.sidebar-logo[_ngcontent-%COMP%]{padding:12px 16px 16px;text-align:center}.sidebar-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transition:all .3s ease;margin-bottom:16px}.sidebar-nav[_ngcontent-%COMP%]{padding:8px 0;flex:1;position:relative;z-index:2}.nav-list[_ngcontent-%COMP%]{padding:0;margin:0;display:flex;flex-direction:column;gap:2px;list-style:none}.nav-item[_ngcontent-%COMP%]{border-radius:8px;transition:all .2s ease;position:relative;overflow:visible;margin:0 12px}.nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#9ca3af;font-size:15px;font-weight:500;padding:8px 12px;display:flex;align-items:center;gap:12px;border-radius:8px;background:transparent;text-decoration:none;transition:all .2s ease;min-height:36px}.nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]{font-size:18px;color:#9ca3af;min-width:20px;text-align:center;transition:color .2s ease}.nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   .nav-label[_ngcontent-%COMP%]{color:#9ca3af;font-weight:500;font-size:15px;transition:all .2s ease;white-space:nowrap}.nav-item[_ngcontent-%COMP%]:hover{background:transparent;position:relative}.nav-item[_ngcontent-%COMP%]:hover:before{content:"";position:absolute;left:0;top:0;bottom:0;width:5px;background:#2563eb;border-radius:3px 8px 8px 3px}.nav-item[_ngcontent-%COMP%]:hover   .nav-link[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%], .nav-item[_ngcontent-%COMP%]:hover   .nav-link[_ngcontent-%COMP%]   .nav-label[_ngcontent-%COMP%]{color:#2563eb!important}.nav-item.active[_ngcontent-%COMP%]{background:transparent;position:relative}.nav-item.active[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;top:0;bottom:0;width:3px;background:#2563eb;border-radius:0 2px 2px 0}.nav-item.active[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%], .nav-item.active[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   .nav-label[_ngcontent-%COMP%]{color:#2563eb!important}.back-to-home[_ngcontent-%COMP%]{background:#2563eb;color:#fff!important;border-radius:24px;padding:8px 12px;margin:20px 12px 16px;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:15px;transition:all .2s ease;text-decoration:none;min-height:36px;gap:8px}.back-to-home[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#fff!important;font-size:18px;transition:transform .2s ease}.back-to-home[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff!important;white-space:nowrap}.back-to-home[_ngcontent-%COMP%]:hover{background:#2563eb;color:#fff!important;transform:translateY(-1px);box-shadow:0 4px 12px #4285f44d;text-decoration:none}.back-to-home[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{transform:scale(1.1)}@media (max-width: 1024px){.sidebar[_ngcontent-%COMP%]{width:80px;border-radius:0 16px 16px 0;display:flex;flex-direction:column;align-items:center}.sidebar[_ngcontent-%COMP%]   .nav-list[_ngcontent-%COMP%]{gap:0;padding:0;align-items:center}.sidebar[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{margin:0;display:flex;justify-content:center;align-items:center}.sidebar[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{justify-content:center;align-items:center;padding:10px 0;min-height:44px;width:48px;margin:0 auto}.sidebar[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]{font-size:22px!important;color:#2563eb!important;margin:0!important;width:22px!important;text-align:center}.sidebar[_ngcontent-%COMP%]   .back-to-home[_ngcontent-%COMP%]{min-height:44px;width:48px;padding:0;margin:8px auto;display:flex;justify-content:center;align-items:center}.sidebar[_ngcontent-%COMP%]   .back-to-home[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}.sidebar[_ngcontent-%COMP%]   .back-to-home[_ngcontent-%COMP%]   .bi-house-door-fill[_ngcontent-%COMP%]{font-size:22px;margin:0}.main-content[_ngcontent-%COMP%]{margin-left:80px}.toggle-btn[_ngcontent-%COMP%], .toggle-btn-out[_ngcontent-%COMP%]{display:none}}@media (max-width: 768px){.sidebar[_ngcontent-%COMP%]{transform:none!important;border-radius:0}.main-content[_ngcontent-%COMP%]{margin-left:0}.toggle-btn[_ngcontent-%COMP%]{display:flex;top:20px;left:20px;transform:none}.toggle-btn-out[_ngcontent-%COMP%]{display:none}.toggle-btn[_ngcontent-%COMP%], .toggle-btn-out[_ngcontent-%COMP%]{display:none!important}}@keyframes _ngcontent-%COMP%_slideInRight{0%{opacity:0;transform:translate(-20px)}to{opacity:1;transform:translate(0)}}.sidebar[_ngcontent-%COMP%]:not(.collapsed)   .nav-item[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideInRight .3s ease forwards}.sidebar[_ngcontent-%COMP%]:not(.collapsed)   .nav-item[_ngcontent-%COMP%]:nth-child(1){animation-delay:.05s}.sidebar[_ngcontent-%COMP%]:not(.collapsed)   .nav-item[_ngcontent-%COMP%]:nth-child(2){animation-delay:.1s}.sidebar[_ngcontent-%COMP%]:not(.collapsed)   .nav-item[_ngcontent-%COMP%]:nth-child(3){animation-delay:.15s}.sidebar[_ngcontent-%COMP%]:not(.collapsed)   .nav-item[_ngcontent-%COMP%]:nth-child(4){animation-delay:.2s}.sidebar[_ngcontent-%COMP%]:not(.collapsed)   .nav-item[_ngcontent-%COMP%]:nth-child(5){animation-delay:.25s}.sidebar[_ngcontent-%COMP%]:not(.collapsed)   .nav-item[_ngcontent-%COMP%]:nth-child(6){animation-delay:.3s}.sidebar[_ngcontent-%COMP%]:not(.collapsed)   .nav-item[_ngcontent-%COMP%]:nth-child(7){animation-delay:.35s}.sidebar[_ngcontent-%COMP%]:not(.collapsed)   .nav-item[_ngcontent-%COMP%]:nth-child(8){animation-delay:.4s}.sidebar[_ngcontent-%COMP%]:not(.collapsed)   .nav-item[_ngcontent-%COMP%]:nth-child(9){animation-delay:.45s}.sidebar[_ngcontent-%COMP%]:not(.collapsed)   .nav-item[_ngcontent-%COMP%]:nth-child(10){animation-delay:.5s}.sidebar[_ngcontent-%COMP%]:not(.collapsed)   .nav-label[_ngcontent-%COMP%]{opacity:1;transform:translate(0)}']})}}return e})();function _t(e,d){if(e&1&&(o(0,"span",15),g(1),r()),e&2){let t=f(2);a(),z(" ",t.unreadNotificationsCount," ")}}function ut(e,d){if(e&1){let t=C();o(0,"div",12),m("click",function(){_(t);let n=f();return u(n.toggleNotifications())}),p(1,"i",13),h(2,_t,2,1,"span",14),r()}if(e&2){let t=f();a(2),c("ngIf",t.unreadNotificationsCount>0)}}function Ct(e,d){e&1&&(o(0,"div",22),g(1," No recent activities "),r())}function Ot(e,d){if(e&1&&(o(0,"div",23)(1,"div",24),p(2,"i",25),o(3,"div")(4,"p"),g(5),r(),o(6,"small"),g(7),F(8,"date"),r()()()()),e&2){let t=d.$implicit;a(5),x(t.description),a(2),x(L(8,2,t.date,"mediumDate"))}}function xt(e,d){if(e&1){let t=C();o(0,"div",16)(1,"div",17)(2,"h4"),g(3,"Recent Activities"),r(),o(4,"span",18),m("click",function(){_(t);let n=f();return u(n.toggleNotifications())}),g(5,"\xD7"),r()(),o(6,"div",19),h(7,Ct,2,0,"div",20)(8,Ot,9,5,"div",21),r()()}if(e&2){let t=f();a(7),c("ngIf",t.recentActivities.length===0),a(),c("ngForOf",t.recentActivities)}}function vt(e,d){if(e&1){let t=C();o(0,"div",26)(1,"a",27),g(2,"Settings"),r(),o(3,"a",28),m("click",function(){_(t);let n=f();return u(n.logOut())}),g(4,"Logout"),r()()}}var it=(()=>{class e{constructor(t,i,n){this.settingService=t,this.authService=i,this.dashboardService=n,this.pageTitle="Overview",this.DEFAULT_PROFILE_IMAGE="assets/WhatsApp Image 2025-04-24 at 14.52.36_a522ea2e.jpg",this.userName="",this.userRole="",this.isDropdownOpen=!1,this.isNotificationOpen=!1,this.recentActivities=[],this.unreadNotificationsCount=0,this.showNotifications=!1,this.today=new Date,this.subscription=new w,this.handleDocumentClick=s=>{let O=document.querySelector(".user-profile"),U=document.querySelector(".notifications-dropdown");this.isDropdownOpen&&O&&!O.contains(s.target)&&(this.isDropdownOpen=!1),this.isNotificationOpen&&U&&!U.contains(s.target)&&!s.target.classList.contains("notification-icon")&&(this.isNotificationOpen=!1)};let l=this.authService.getUserData();l?(this.userName=l.name||"User",this.profileImage=this.getSafeImageUrl(l.profilePicture),l.roleId===1?(this.userRole="Admin",this.showNotifications=!0):l.roleId===2?(this.userRole="User",this.showNotifications=!1):(this.userRole=l.roleName||"",this.showNotifications=["manager","admin","supervisor"].some(s=>this.userRole.toLowerCase().includes(s)))):this.profileImage=this.DEFAULT_PROFILE_IMAGE,this.subscription.add(this.settingService.profileImage$.subscribe(s=>{this.profileImage=this.getSafeImageUrl(s),localStorage.setItem("profileImage",s)}))}ngOnInit(){let t=localStorage.getItem("profileImage");this.profileImage=this.getSafeImageUrl(t),this.showNotifications&&this.fetchRecentActivities(),document.addEventListener("click",this.handleDocumentClick,!0)}ngOnDestroy(){document.removeEventListener("click",this.handleDocumentClick,!0),this.subscription.unsubscribe()}getSafeImageUrl(t){return t?/^[a-zA-Z0-9+/=]{100,}$/.test(t)?`data:image/png;base64,${t}`:t.startsWith("http://")||t.startsWith("https://")?t:this.DEFAULT_PROFILE_IMAGE:this.DEFAULT_PROFILE_IMAGE}resetToDefaultImage(){this.profileImage=this.DEFAULT_PROFILE_IMAGE,localStorage.removeItem("profileImage")}fetchRecentActivities(){this.dashboardService.getRecentActivities().pipe(k(1),S(t=>{console.log("Recent Activities:",t)}),y(t=>(console.error("Error fetching recent activities:",t),I([])))).subscribe(t=>{this.recentActivities=t.sort((i,n)=>new Date(n.date).getTime()-new Date(i.date).getTime()).slice(0,4),this.unreadNotificationsCount=this.recentActivities.length})}toggleNotifications(){this.showNotifications&&(this.isNotificationOpen=!this.isNotificationOpen,this.isNotificationOpen&&(this.unreadNotificationsCount=0))}toggleDropdown(){this.isDropdownOpen=!this.isDropdownOpen,this.isDropdownOpen&&(this.isNotificationOpen=!1)}logOut(){this.authService.logout()}handleImageError(t){let i=t.target;i.src=this.DEFAULT_PROFILE_IMAGE}static{this.\u0275fac=function(i){return new(i||e)(b(D),b(T),b(A))}}static{this.\u0275cmp=v({type:e,selectors:[["app-navbar-dashboard"]],inputs:{pageTitle:"pageTitle"},decls:18,vars:10,consts:[[1,"navbar","enhanced-navbar"],[1,"navbar-left"],[1,"dashboard-title"],[1,"navbar-date","small-date"],[1,"navbar-right"],["class","notification rounded-circle-icon",3,"click",4,"ngIf"],["class","notifications-dropdown",4,"ngIf"],[1,"user-profile"],[1,"user-info",3,"click"],[1,"bi","bi-chevron-down"],["alt","Profile",1,"profile-img",3,"click","error","src"],["class","dropdown-menu",4,"ngIf"],[1,"notification","rounded-circle-icon",3,"click"],[1,"bi","bi-bell-fill","notification-icon"],["class","notification-badge",4,"ngIf"],[1,"notification-badge"],[1,"notifications-dropdown"],[1,"notifications-header"],[1,"close-btn",3,"click"],[1,"notifications-list"],["class","no-notifications",4,"ngIf"],["class","notification-item",4,"ngFor","ngForOf"],[1,"no-notifications"],[1,"notification-item"],[1,"notification-content"],[1,"bi","bi-check-circle","notification-icon"],[1,"dropdown-menu"],["href","/dashboard/settings"],[3,"click"]],template:function(i,n){i&1&&(o(0,"nav",0)(1,"div",1)(2,"h2",2),g(3),r(),o(4,"div",3)(5,"span"),g(6),F(7,"date"),r()()(),o(8,"div",4),h(9,ut,3,1,"div",5)(10,xt,9,2,"div",6),o(11,"div",7)(12,"div",8),m("click",function(){return n.toggleDropdown()}),o(13,"span"),g(14),r(),p(15,"i",9),r(),o(16,"img",10),m("click",function(){return n.toggleDropdown()})("error",function(s){return n.handleImageError(s)}),r(),h(17,vt,5,0,"div",11),r()()()),i&2&&(a(3),x(n.pageTitle),a(3),x(L(7,7,n.today,"fullDate")),a(3),c("ngIf",n.showNotifications),a(),c("ngIf",n.showNotifications&&n.isNotificationOpen),a(4),z("Hi, ",n.userRole,""),a(2),c("src",n.profileImage,V),a(),c("ngIf",n.isDropdownOpen))},dependencies:[P,E,M,Y],styles:[".navbar[_ngcontent-%COMP%]{align-items:center;padding:15px 20px;position:fixed;top:0;left:270px;right:200px;z-index:1000;transition:left .3s,width .3s}[_nghost-%COMP%]{display:block;height:64px}.navbar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:22px;color:#42f48f3b;font-weight:700;margin:0}.navbar-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px}.rounded-circle-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;background-color:#f5f7fa;padding:8px;border-radius:50%;cursor:pointer;transition:background .3s}.rounded-circle-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:18px;color:#2563eb}.rounded-circle-icon[_ngcontent-%COMP%]:hover{background-color:#e2e6ea}.user-profile[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;gap:10px}.user-profile[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{cursor:pointer;font-weight:500;color:#222;transition:color .2s}.user-profile[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]:hover{color:#2563eb}.user-profile[_ngcontent-%COMP%]   .profile-img[_ngcontent-%COMP%]{width:38px;height:38px;border-radius:50%;object-fit:cover;border:2px solid #eee;cursor:pointer;transition:border .2s}.user-profile[_ngcontent-%COMP%]   .profile-img[_ngcontent-%COMP%]:hover{border:2px solid #2563eb}.user-profile[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:120%;right:0;min-width:140px;background:#fff;border-radius:10px;box-shadow:0 8px 24px #00000021;padding:8px 0;z-index:100;display:flex;flex-direction:column;animation:_ngcontent-%COMP%_fadeIn .2s;border:1px solid #f0f0f0}.user-profile[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{padding:10px 18px;color:#222;text-decoration:none;font-size:15px;transition:background .2s,color .2s;cursor:pointer}.user-profile[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background:#f5f7fa;color:#2563eb}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.sidebar.collapsed[_ngcontent-%COMP%] + .navbar[_ngcontent-%COMP%]{left:70px;width:calc(100% - 70px)}.notification[_ngcontent-%COMP%]{position:relative}.notification[_ngcontent-%COMP%]   .notification-badge[_ngcontent-%COMP%]{position:absolute;top:-4px;right:-4px;background-color:#2563eb;color:#fff;border-radius:50%;width:16px;height:16px;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700}.notifications-dropdown[_ngcontent-%COMP%]{position:absolute;top:70px;right:2rem;width:320px;background:#fff;border-radius:12px;box-shadow:0 8px 32px #00000021;z-index:1050;max-height:400px;overflow-y:auto;border:1.5px solid #e0e4ea;padding:0;animation:_ngcontent-%COMP%_fadeIn .2s}.notifications-dropdown[_ngcontent-%COMP%]   .notifications-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:18px 20px 12px;border-bottom:1px solid #e9ecef}.notifications-dropdown[_ngcontent-%COMP%]   .notifications-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:17px;color:#1e1e2d;font-weight:700}.notifications-dropdown[_ngcontent-%COMP%]   .notifications-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{cursor:pointer;font-size:24px;color:#6c757d;background:none;border:none;padding:0 2px;line-height:1;transition:color .2s}.notifications-dropdown[_ngcontent-%COMP%]   .notifications-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]:hover{color:#2563eb}.notifications-dropdown[_ngcontent-%COMP%]   .notifications-list[_ngcontent-%COMP%]   .no-notifications[_ngcontent-%COMP%]{text-align:center;padding:22px 0;color:#6c757d;font-size:15px}.notifications-dropdown[_ngcontent-%COMP%]   .notifications-list[_ngcontent-%COMP%]   .notification-item[_ngcontent-%COMP%]{padding:12px 20px;border-bottom:1px solid #f0f0f0;transition:background-color .2s}.notifications-dropdown[_ngcontent-%COMP%]   .notifications-list[_ngcontent-%COMP%]   .notification-item[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.notifications-dropdown[_ngcontent-%COMP%]   .notifications-list[_ngcontent-%COMP%]   .notification-item[_ngcontent-%COMP%]   .notification-content[_ngcontent-%COMP%]{display:flex;align-items:center}.notifications-dropdown[_ngcontent-%COMP%]   .notifications-list[_ngcontent-%COMP%]   .notification-item[_ngcontent-%COMP%]   .notification-content[_ngcontent-%COMP%]   .notification-icon[_ngcontent-%COMP%]{margin-right:12px;color:#2563eb;font-size:20px}.notifications-dropdown[_ngcontent-%COMP%]   .notifications-list[_ngcontent-%COMP%]   .notification-item[_ngcontent-%COMP%]   .notification-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;color:#495057}.notifications-dropdown[_ngcontent-%COMP%]   .notifications-list[_ngcontent-%COMP%]   .notification-item[_ngcontent-%COMP%]   .notification-content[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#6c757d;font-size:12px;display:block;margin-top:5px}.enhanced-navbar[_ngcontent-%COMP%]{background:#fff;border-bottom:1.5px solid #e0e4ea;box-shadow:none;height:80px;display:flex;align-items:center;justify-content:space-between;padding:0 2rem;position:fixed;top:0;left:80px;width:calc(100% - 80px);z-index:1000}.enhanced-navbar[_ngcontent-%COMP%]   .navbar-left[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;justify-content:center;flex:1}.enhanced-navbar[_ngcontent-%COMP%]   .dashboard-title[_ngcontent-%COMP%]{color:#2563eb;font-size:2rem;font-weight:700;margin:0;letter-spacing:1px}.enhanced-navbar[_ngcontent-%COMP%]   .navbar-date[_ngcontent-%COMP%]{color:#64748b;font-size:1.05rem;font-weight:500;margin-top:2px}.enhanced-navbar[_ngcontent-%COMP%]   .navbar-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:18px}.enhanced-navbar[_ngcontent-%COMP%]   .rounded-circle-icon[_ngcontent-%COMP%]{background:#f5f7fa;border-radius:50%;padding:8px;display:flex;align-items:center;justify-content:center;transition:background .2s;cursor:pointer}.enhanced-navbar[_ngcontent-%COMP%]   .rounded-circle-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px;color:#2563eb}.enhanced-navbar[_ngcontent-%COMP%]   .rounded-circle-icon[_ngcontent-%COMP%]:hover{background:#e2e6ea}.enhanced-navbar[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.enhanced-navbar[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{color:#222;font-weight:500;font-size:15px;cursor:pointer}.enhanced-navbar[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]:hover{color:#2563eb}.enhanced-navbar[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .profile-img[_ngcontent-%COMP%]{width:38px;height:38px;border-radius:50%;object-fit:cover;border:2px solid #eee;transition:border .2s}.enhanced-navbar[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .profile-img[_ngcontent-%COMP%]:hover{border:2px solid #2563eb}.enhanced-navbar[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{right:0;left:auto}.enhanced-navbar[_ngcontent-%COMP%]   .notification-badge[_ngcontent-%COMP%]{position:absolute;top:-4px;right:-4px;background:#2563eb;color:#fff;border-radius:50%;width:16px;height:16px;font-size:10px;display:flex;align-items:center;justify-content:center;font-weight:700}@media (max-width: 1024px){.enhanced-navbar[_ngcontent-%COMP%]{left:0;width:100%;padding:0 1rem;height:70px}.enhanced-navbar[_ngcontent-%COMP%]   .dashboard-title[_ngcontent-%COMP%]{font-size:1.5rem}.enhanced-navbar[_ngcontent-%COMP%]   .navbar-date[_ngcontent-%COMP%]{font-size:.9rem}.enhanced-navbar[_ngcontent-%COMP%]   .navbar-right[_ngcontent-%COMP%]{gap:15px}.notifications-dropdown[_ngcontent-%COMP%]{width:280px;right:1rem}}@media (max-width: 768px){.enhanced-navbar[_ngcontent-%COMP%]{height:60px;padding:0 .75rem}.enhanced-navbar[_ngcontent-%COMP%]   .navbar-left[_ngcontent-%COMP%]{align-items:center;justify-content:center;width:100%}.enhanced-navbar[_ngcontent-%COMP%]   .dashboard-title[_ngcontent-%COMP%], .enhanced-navbar[_ngcontent-%COMP%]   .navbar-date[_ngcontent-%COMP%]{width:100%;text-align:center}.enhanced-navbar[_ngcontent-%COMP%]   .navbar-right[_ngcontent-%COMP%]{gap:12px}.enhanced-navbar[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}.enhanced-navbar[_ngcontent-%COMP%]   .profile-img[_ngcontent-%COMP%]{width:32px;height:32px}.enhanced-navbar[_ngcontent-%COMP%]   .rounded-circle-icon[_ngcontent-%COMP%]{padding:6px}.enhanced-navbar[_ngcontent-%COMP%]   .rounded-circle-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:18px}.notifications-dropdown[_ngcontent-%COMP%]{width:95vw;right:2.5vw;top:65px;max-width:300px}}@media (max-width: 480px){.enhanced-navbar[_ngcontent-%COMP%]{height:55px;padding:0 .5rem}.enhanced-navbar[_ngcontent-%COMP%]   .navbar-left[_ngcontent-%COMP%]{align-items:center;justify-content:center;width:100%}.enhanced-navbar[_ngcontent-%COMP%]   .dashboard-title[_ngcontent-%COMP%], .enhanced-navbar[_ngcontent-%COMP%]   .navbar-date[_ngcontent-%COMP%]{width:100%;text-align:center}.notifications-dropdown[_ngcontent-%COMP%]{width:100vw;right:0;left:0;top:58px;border-radius:0;max-height:300px}}@media (max-width: 320px){.enhanced-navbar[_ngcontent-%COMP%]   .dashboard-title[_ngcontent-%COMP%]{font-size:.9rem;max-width:150px}.enhanced-navbar[_ngcontent-%COMP%]   .navbar-date[_ngcontent-%COMP%]{font-size:.65rem;max-width:150px}.enhanced-navbar[_ngcontent-%COMP%]   .navbar-right[_ngcontent-%COMP%]{gap:6px}.enhanced-navbar[_ngcontent-%COMP%]   .profile-img[_ngcontent-%COMP%]{width:26px;height:26px}}"]})}}return e})();function Mt(e,d){e&1&&p(0,"app-loading")}var Jt=(()=>{class e{constructor(){this.pageTitle="Dashboard",this.isLoading=!1,this.subscriptions=[]}updateTitle(t){this.pageTitle=t}ngOnInit(){let t=this.loadingService.loading$.subscribe(i=>{this.isLoading!==i&&(this.isLoading=i,this.cdr.detectChanges())});this.subscriptions.push(t)}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=v({type:e,selectors:[["app-dashboard"]],decls:7,vars:2,consts:[[1,"dashboard-layout"],[4,"ngIf"],[1,"sidebar",3,"titleChange"],[1,"main-area"],[1,"mb-3",3,"pageTitle"],[1,"dashboard-content"]],template:function(i,n){i&1&&(o(0,"div",0),h(1,Mt,1,0,"app-loading",1),o(2,"app-sidebar",2),m("titleChange",function(s){return n.updateTitle(s)}),r(),o(3,"div",3),p(4,"app-navbar-dashboard",4),o(5,"div",5),p(6,"router-outlet"),r()()()),i&2&&(a(),c("ngIf",n.isLoading),a(3),c("pageTitle",n.pageTitle))},dependencies:[P,M,N,Z,nt,it,X,Q],styles:[".dashboard[_ngcontent-%COMP%]{margin:70px 70px 70px 280px;padding:20px;transition:margin-left .3s,width .3s}.dashboard-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:20px;margin:0;padding:20px;overflow-y:auto}.sidebar.collapsed[_ngcontent-%COMP%] + .dashboard[_ngcontent-%COMP%]{margin-left:60px;width:calc(100% - 60px)}@media (max-width: 768px){.dashboard[_ngcontent-%COMP%]{margin-top:60px;margin-left:62px;width:calc(100% - 65px);padding:15px}.dashboard-content[_ngcontent-%COMP%]{margin-top:0}}.dashboard-layout[_ngcontent-%COMP%]{display:flex;flex-direction:row;height:100vh;width:100vw;overflow:hidden}.sidebar[_ngcontent-%COMP%]{background:#fff;height:100vh;width:60px;transition:width .3s}.main-area[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;min-width:0;background:#fff;padding:0;margin:0;height:100vh;overflow-y:hidden}@media (max-width: 768px){.dashboard-layout[_ngcontent-%COMP%]{flex-direction:column;height:100vh}.sidebar[_ngcontent-%COMP%]{width:100vw;height:60px;position:fixed;top:0;left:0;z-index:10}.main-area[_ngcontent-%COMP%]{height:calc(100vh - 60px);margin:0;padding:0}}"]})}}return e})();export{Jt as DashboardComponent};
