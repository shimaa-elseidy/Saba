import{a as G}from"./chunk-HZXTCNW7.js";import{a as z}from"./chunk-IP3FY2TA.js";import{B as q,c as O,e as c,f as S,g as F,l as N,p as I,s as D,t as k,u as A,v as U,z as T}from"./chunk-5ZW25HYA.js";import"./chunk-CU2TEK6Q.js";import{g as y}from"./chunk-JKYV32XC.js";import"./chunk-SLPUACWX.js";import"./chunk-MMGRQEJU.js";import"./chunk-Q5MV2RZV.js";import{l as E,m as M}from"./chunk-EJ3EEOXZ.js";import{Cb as l,Eb as u,Kb as i,Lb as t,Mb as m,Vb as x,Wb as C,_a as _,eb as s,ec as o,gc as h,kb as b,qb as w,vb as g}from"./chunk-FHROAHAP.js";import{a as v,b as P}from"./chunk-WWX6BADO.js";function L(a,p){if(a&1&&(i(0,"div",40),o(1),t()),a&2){let e=C();s(),h(" ",e.getFieldError("name")," ")}}function j(a,p){if(a&1&&(i(0,"option",41),o(1),t()),a&2){let e=p.$implicit;l("value",e.value),s(),h(" ",e.label," ")}}function B(a,p){a&1&&(i(0,"div",40),o(1," Role is required "),t())}function R(a,p){if(a&1&&(i(0,"div",40),o(1),t()),a&2){let e=C();s(),h(" ",e.getFieldError("email")," ")}}function V(a,p){if(a&1&&(i(0,"div",40),o(1),t()),a&2){let e=C();s(),h(" ",e.getFieldError("phone")," ")}}function $(a,p){if(a&1&&(i(0,"div",40),o(1),t()),a&2){let e=C();s(),h(" ",e.getFieldError("password")," ")}}function Y(a,p){a&1&&(i(0,"div",40),o(1," Confirm password is required "),t())}function J(a,p){a&1&&(i(0,"div",40),o(1," Passwords do not match "),t())}function H(a,p){a&1&&(i(0,"div",40),o(1," Date of birth is required "),t())}function K(a,p){if(a&1&&(i(0,"option",41),o(1),t()),a&2){let e=p.$implicit;l("value",e.value),s(),h(" ",e.label," ")}}function Q(a,p){a&1&&(i(0,"div",40),o(1," Gender is required "),t())}function W(a,p){a&1&&(i(0,"div",40),o(1," Country is required "),t())}var oe=(()=>{class a{constructor(e,n,r,d){this.fb=e,this.userService=n,this.toastr=r,this.router=d,this.profilePicture="../../../assets/avatar.jpg",this.serverErrors={},this.isSubmitting=!1,this.roleOptions=[{value:"admin",label:"Admin"},{value:"user",label:"User"}],this.genderOptions=[{value:"male",label:"Male"},{value:"female",label:"Female"}],this.initializeForm()}initializeForm(){this.userForm=this.fb.group({username:["",[c.required,c.minLength(3)]],email:["",[c.required,c.email]],password:["",[c.required,c.minLength(6)]],confirmPassword:["",c.required],birthDate:["",c.required],location:["",c.required],phone:["",[c.required,c.pattern(/^(\+\d{1,4})?[ -]?\d{1,15}$/)]],role:["",c.required],gender:["",c.required],firstName:[""],lastName:[""],city:[""],presentAddress:[""],isEmailConfirmed:[!1],memberStatus:[!1],sendEmail:[!1],profilePicture:[null]},{validators:this.passwordMatchValidator})}passwordMatchValidator(e){let n=e.get("password")?.value,r=e.get("confirmPassword")?.value;return n===r?null:{mismatch:!0}}onImageChange(e){let n=e.target.files[0];if(n){if(!["image/jpeg","image/png","image/gif"].includes(n.type)){this.toastr.error("Please select a valid image file (JPEG, PNG, or GIF)","Invalid File Type");return}let d=2*1024*1024;if(n.size>d){this.toastr.error("File size must be less than 2MB","File Too Large");return}let f=new FileReader;f.onload=()=>{this.profilePicture=f.result,this.userForm.patchValue({profilePicture:this.profilePicture})},f.readAsDataURL(n)}}onSubmit(){if(this.serverErrors={},this.userForm.valid){this.isSubmitting=!0;let e=this.userForm.value,n=P(v(v(v(v(v({username:e.username.trim(),email:e.email.trim().toLowerCase(),password:e.password,confirmPassword:e.confirmPassword,birthDate:new Date(e.birthDate).toISOString(),location:e.location.trim(),isEmailConfirmed:e.isEmailConfirmed,profilePicture:e.profilePicture,phone:e.phone.trim(),role:e.role},e.firstName&&{firstName:e.firstName.trim()}),e.lastName&&{lastName:e.lastName.trim()}),e.gender&&{gender:e.gender}),e.city&&{city:e.city.trim()}),e.presentAddress&&{presentAddress:e.presentAddress.trim()}),{memberStatus:e.memberStatus,sendEmail:e.sendEmail});this.userService.createUser(n).subscribe({next:r=>{this.isSubmitting=!1,this.toastr.success("User created successfully","Success!"),this.onClose()},error:r=>{this.isSubmitting=!1,console.error("Error creating user:",r),this.handleServerErrors(r)}})}else this.markFormGroupTouched(),this.toastr.warning("Please fill in all required fields correctly.","Form Invalid")}handleServerErrors(e){if(e.status===400&&e.error)try{let n=e.error;if(typeof n=="string"&&(n=JSON.parse(n)),n.errors)this.serverErrors=n.errors,Object.keys(this.serverErrors).forEach(r=>{let d=this.serverErrors[r];Array.isArray(d)&&d.length>0&&this.toastr.error(d[0],`${r} Error`)});else if(n.title&&n.status===400)this.toastr.error(n.title,"Validation Error");else{let r=n.message||n.title||"Failed to create user";this.toastr.error(r,"Error!")}}catch{this.toastr.error("An error occurred while creating the user","Error!")}else{let n=e.error?.message||e.message||"Failed to create user";this.toastr.error(n,"Error!")}}markFormGroupTouched(){Object.keys(this.userForm.controls).forEach(e=>{this.userForm.get(e)?.markAsTouched()})}onClose(){this.userForm.reset(),this.profilePicture="../../../assets/avatar.jpg",this.serverErrors={},this.isSubmitting=!1,this.router.navigate(["/dashboard/user-management"])}isFieldInvalid(e){let n=this.userForm.get(e);return!!(n&&n.invalid&&(n.dirty||n.touched))||this.hasServerError(e)}hasServerError(e){return({username:["Username","username","Name"],email:["Email","EmailAddress","Email Address"],password:["Password"],confirmPassword:["ConfirmPassword","Confirm Password"],phone:["Phone","PhoneNumber","Phone Number"],birthDate:["BirthDate","Date of Birth","DateOfBirth"],location:["Location","Country"],role:["Role"],gender:["Gender"],firstName:["FirstName","First Name"],lastName:["LastName","Last Name"],city:["City"],presentAddress:["PresentAddress","Present Address","Address"]}[e]||[e]).some(d=>this.serverErrors[d])}getFieldError(e){let n=this.userForm.get(e),d={username:["Username","username","Name"],email:["Email","EmailAddress","Email Address"],password:["Password"],confirmPassword:["ConfirmPassword","Confirm Password"],phone:["Phone","PhoneNumber","Phone Number"],birthDate:["BirthDate","Date of Birth","DateOfBirth"],location:["Location","Country"],role:["Role"],gender:["Gender"],firstName:["FirstName","First Name"],lastName:["LastName","Last Name"],city:["City"],presentAddress:["PresentAddress","Present Address","Address"]}[e]||[e];for(let f of d)if(this.serverErrors[f]&&Array.isArray(this.serverErrors[f]))return this.serverErrors[f][0];if(n?.errors){if(n.errors.required)return`${this.getFieldDisplayName(e)} is required`;if(n.errors.email)return"Please enter a valid email address";if(n.errors.minlength)return`${this.getFieldDisplayName(e)} must be at least ${n.errors.minlength.requiredLength} characters`;if(n.errors.pattern)return"Please enter a valid phone number (country code optional)"}return""}getFieldDisplayName(e){return{username:"Username",email:"Email",password:"Password",confirmPassword:"Confirm Password",phone:"Phone Number",birthDate:"Date of Birth",location:"Country",role:"Role",gender:"Gender",firstName:"First Name",lastName:"Last Name",city:"City",presentAddress:"Present Address"}[e]||e}getMaxDate(){let e=new Date;return new Date(e.getFullYear()-18,e.getMonth(),e.getDate()).toISOString().split("T")[0]}static{this.\u0275fac=function(n){return new(n||a)(b(T),b(G),b(z),b(y))}}static{this.\u0275cmp=w({type:a,selectors:[["app-create-new-user"]],decls:111,vars:34,consts:[[1,"container","p-4"],[1,"form-title","mb-4"],[1,"row"],[1,"col-md-3","d-flex","flex-column","align-items-center"],[1,"position-relative","mb-3"],["alt","Profile Picture",1,"rounded-circle","profile-image",3,"src"],["title","Change Profile Picture",1,"position-absolute","bottom-0","end-0","bg-light","rounded-circle","p-2","edit-icon",2,"cursor","pointer"],["type","file","hidden","","accept","image/*",3,"change"],[1,"bi","bi-pencil"],[1,"col-md-9"],["novalidate","",3,"ngSubmit","formGroup"],[1,"row","g-3"],[1,"col-md-6"],[1,"form-label"],[1,"text-danger"],["type","text","formControlName","username","placeholder","Enter username","autocomplete","username",1,"form-control"],["class","invalid-feedback",4,"ngIf"],[1,"select-wrapper"],["formControlName","role",1,"form-select"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","text","formControlName","firstName","placeholder","Enter first name","autocomplete","given-name",1,"form-control"],["type","text","formControlName","lastName","placeholder","Enter last name","autocomplete","family-name",1,"form-control"],["type","email","formControlName","email","placeholder","Enter email address","autocomplete","email",1,"form-control"],[1,"phone-input-container"],["type","tel","formControlName","phone","placeholder","Enter phone number (e.g. +1 234 567 8900)","autocomplete","tel",1,"form-control"],[1,"phone-hint"],["type","password","formControlName","password","placeholder","Enter password","autocomplete","new-password",1,"form-control"],["type","password","formControlName","confirmPassword","placeholder","Confirm password","autocomplete","new-password",1,"form-control"],["type","date","formControlName","birthDate",1,"form-control",3,"max"],["formControlName","gender",1,"form-select"],["type","text","formControlName","location","placeholder","Enter country","autocomplete","country",1,"form-control"],["type","text","formControlName","city","placeholder","Enter city","autocomplete","address-level2",1,"form-control"],[1,"col-md-12"],["formControlName","presentAddress","placeholder","Enter present address","rows","2","autocomplete","street-address",1,"form-control"],[1,"col-12","text-end","mt-4"],["type","submit",1,"btn","btn-primary","me-3",3,"disabled"],[1,"bi","bi-check-circle","me-2"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"bi","bi-arrow-left","me-2"],[1,"invalid-feedback"],[3,"value"]],template:function(n,r){if(n&1&&(i(0,"div",0)(1,"h2",1),o(2,"Create New User"),t(),i(3,"div",2)(4,"div",3)(5,"div",4),m(6,"img",5),i(7,"label",6)(8,"input",7),x("change",function(f){return r.onImageChange(f)}),t(),m(9,"i",8),t()()(),i(10,"div",9)(11,"form",10),x("ngSubmit",function(){return r.onSubmit()}),i(12,"div",11)(13,"div",12)(14,"label",13),o(15,"Username"),i(16,"span",14),o(17,"*"),t()(),m(18,"input",15),g(19,L,2,1,"div",16),t(),i(20,"div",12)(21,"label",13),o(22,"Role"),i(23,"span",14),o(24,"*"),t()(),i(25,"div",17)(26,"select",18)(27,"option",19),o(28,"Select Role..."),t(),g(29,j,2,2,"option",20),t()(),g(30,B,2,0,"div",16),t(),i(31,"div",12)(32,"label",13),o(33,"First Name"),t(),m(34,"input",21),t(),i(35,"div",12)(36,"label",13),o(37,"Last Name"),t(),m(38,"input",22),t(),i(39,"div",12)(40,"label",13),o(41,"Email Address"),i(42,"span",14),o(43,"*"),t()(),m(44,"input",23),g(45,R,2,1,"div",16),t(),i(46,"div",12)(47,"label",13),o(48,"Phone Number"),i(49,"span",14),o(50,"*"),t()(),i(51,"div",24),m(52,"input",25),i(53,"small",26),o(54,"Country code optional"),t()(),g(55,V,2,1,"div",16),t(),i(56,"div",12)(57,"label",13),o(58,"Password"),i(59,"span",14),o(60,"*"),t()(),m(61,"input",27),g(62,$,2,1,"div",16),t(),i(63,"div",12)(64,"label",13),o(65,"Confirm Password"),i(66,"span",14),o(67,"*"),t()(),m(68,"input",28),g(69,Y,2,0,"div",16)(70,J,2,0,"div",16),t(),i(71,"div",12)(72,"label",13),o(73,"Date of Birth"),i(74,"span",14),o(75,"*"),t()(),m(76,"input",29),g(77,H,2,0,"div",16),t(),i(78,"div",12)(79,"label",13),o(80,"Gender"),i(81,"span",14),o(82,"*"),t()(),i(83,"div",17)(84,"select",30)(85,"option",19),o(86,"Select Gender..."),t(),g(87,K,2,2,"option",20),t()(),g(88,Q,2,0,"div",16),t(),i(89,"div",12)(90,"label",13),o(91,"Country"),i(92,"span",14),o(93,"*"),t()(),m(94,"input",31),g(95,W,2,0,"div",16),t(),i(96,"div",12)(97,"label",13),o(98,"City"),t(),m(99,"input",32),t(),i(100,"div",33)(101,"label",13),o(102,"Present Address"),t(),m(103,"textarea",34),t(),i(104,"div",35)(105,"button",36),m(106,"i",37),o(107," Save User "),t(),i(108,"button",38),x("click",function(){return r.onClose()}),m(109,"i",39),o(110," Back "),t()()()()()()()),n&2){let d,f;s(6),l("src",r.profilePicture,_),s(5),l("formGroup",r.userForm),s(7),u("is-invalid",r.isFieldInvalid("name")),s(),l("ngIf",r.isFieldInvalid("name")),s(7),u("is-invalid",r.isFieldInvalid("role")),s(3),l("ngForOf",r.roleOptions),s(),l("ngIf",r.isFieldInvalid("role")),s(14),u("is-invalid",r.isFieldInvalid("email")),s(),l("ngIf",r.isFieldInvalid("email")),s(7),u("is-invalid",r.isFieldInvalid("phone")),s(3),l("ngIf",r.isFieldInvalid("phone")),s(6),u("is-invalid",r.isFieldInvalid("password")),s(),l("ngIf",r.isFieldInvalid("password")),s(6),u("is-invalid",r.isFieldInvalid("confirmPassword")||r.userForm.hasError("mismatch")&&((d=r.userForm.get("confirmPassword"))==null?null:d.touched)),s(),l("ngIf",r.isFieldInvalid("confirmPassword")),s(),l("ngIf",r.userForm.hasError("mismatch")&&((f=r.userForm.get("confirmPassword"))==null?null:f.touched)),s(6),u("is-invalid",r.isFieldInvalid("birthDate")),l("max",r.getMaxDate()),s(),l("ngIf",r.isFieldInvalid("birthDate")),s(7),u("is-invalid",r.isFieldInvalid("gender")),s(3),l("ngForOf",r.genderOptions),s(),l("ngIf",r.isFieldInvalid("gender")),s(6),u("is-invalid",r.isFieldInvalid("location")),s(),l("ngIf",r.isFieldInvalid("location")),s(10),l("disabled",r.userForm.invalid)}},dependencies:[q,N,A,U,O,k,S,F,I,D,M,E],styles:['.container[_ngcontent-%COMP%]{background-color:#f5f7fa;width:90%;max-width:1000px;margin:40px auto 100px;border-radius:16px;box-shadow:0 4px 20px #00000014;padding:30px}.profile-image[_ngcontent-%COMP%]{width:130px;height:130px;object-fit:cover;border:3px solid #e9ecef;transition:all .3s ease;box-shadow:0 4px 12px #0000001a}.profile-image[_ngcontent-%COMP%]:hover{border-color:#007bff;transform:scale(1.02)}.edit-icon[_ngcontent-%COMP%]{width:35px;height:35px;display:flex;align-items:center;justify-content:center;border:2px solid #ffffff;box-shadow:0 2px 4px #0003;transition:all .3s ease}.edit-icon[_ngcontent-%COMP%]:hover{background-color:#007bff!important;color:#fff;transform:scale(1.1)}.edit-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:14px}.form-title[_ngcontent-%COMP%]{color:#2d60ff;font-weight:700;text-align:center;margin-bottom:25px;font-size:1.8rem;position:relative}.form-title[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-10px;left:50%;transform:translate(-50%);width:80px;height:3px;background:#2d60ff;border-radius:3px}.form-label[_ngcontent-%COMP%]{font-weight:600;color:#495057;margin-bottom:.5rem;font-size:.9rem}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border:2px solid #e9ecef;border-radius:25px;padding:.75rem 1.2rem;font-size:.9rem;transition:all .3s ease}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:#2d60ff;box-shadow:0 0 0 .2rem #2d60ff33}.form-control.is-invalid[_ngcontent-%COMP%], .form-select.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545}.form-control.is-invalid[_ngcontent-%COMP%]:focus, .form-select.is-invalid[_ngcontent-%COMP%]:focus{border-color:#dc3545;box-shadow:0 0 0 .2rem #dc354540}.form-control[_ngcontent-%COMP%]::placeholder, .form-select[_ngcontent-%COMP%]::placeholder{color:#6c757d;opacity:.7}.select-wrapper[_ngcontent-%COMP%]{position:relative}.select-wrapper[_ngcontent-%COMP%]:after{content:"";position:absolute;top:50%;right:15px;transform:translateY(-50%);width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-top:6px solid #2D60FF;pointer-events:none}.form-select[_ngcontent-%COMP%]{appearance:none;padding-right:2.5rem;background-image:none;cursor:pointer}.form-check-input[_ngcontent-%COMP%]{width:2rem;height:1.2rem;border-radius:2rem}.form-check-input[_ngcontent-%COMP%]:checked{background-color:#007bff;border-color:#007bff}.form-check-input[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem #007bff40}.form-check-label[_ngcontent-%COMP%]{margin-left:.75rem;font-weight:500;color:#495057;cursor:pointer}.btn[_ngcontent-%COMP%]{border-radius:25px;padding:.75rem 2rem;font-weight:600;font-size:.9rem;transition:all .3s ease;min-width:120px}.btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 5px 15px #00000026}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn[_ngcontent-%COMP%]:disabled:hover{transform:none;box-shadow:none}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2d60ff,#1a4fd4);border:none}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#1a4fd4,#0d3cad)}.btn-secondary[_ngcontent-%COMP%]{background:#f8f9fa;border:1px solid #e9ecef;color:#495057}.btn-secondary[_ngcontent-%COMP%]:hover{background:#e9ecef;color:#212529}.invalid-feedback[_ngcontent-%COMP%]{display:block;font-size:.8rem;margin-top:.25rem;margin-left:1rem;margin-bottom:-.5rem;color:#dc3545}.text-danger[_ngcontent-%COMP%]{color:#dc3545!important;margin-left:4px}@media (max-width: 1024px){.container[_ngcontent-%COMP%]{width:calc(100% - 100px);margin:30px 0 80px 80px;padding:25px}.profile-image[_ngcontent-%COMP%]{width:110px;height:110px}}@media (max-width: 768px){.container[_ngcontent-%COMP%]{width:calc(100% - 90px);margin-left:80px;margin-top:20px;padding:20px}.col-md-3[_ngcontent-%COMP%]{margin-bottom:2rem;text-align:center}.profile-image[_ngcontent-%COMP%]{width:100px;height:100px}.edit-icon[_ngcontent-%COMP%]{width:30px;height:30px}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{padding:.6rem .8rem}.btn[_ngcontent-%COMP%]{padding:.6rem 1.2rem;font-size:.85rem}.row.g-3[_ngcontent-%COMP%] > [class*=col-][_ngcontent-%COMP%]{margin-bottom:.75rem}}@media (max-width: 480px){.container[_ngcontent-%COMP%]{width:calc(100% - 90px);margin:10px 0 50px 80px;padding:15px;border-radius:12px}.profile-image[_ngcontent-%COMP%]{width:90px;height:90px}.edit-icon[_ngcontent-%COMP%]{width:28px;height:28px}.form-label[_ngcontent-%COMP%]{font-size:.85rem}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{padding:.5rem .7rem;font-size:.85rem}.btn[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.8rem}}.loading[_ngcontent-%COMP%]{position:relative;pointer-events:none}.loading[_ngcontent-%COMP%]:after{content:"";position:absolute;top:50%;left:50%;width:20px;height:20px;margin:-10px 0 0 -10px;border:2px solid #007bff;border-top-color:transparent;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}input[type=file][_ngcontent-%COMP%]{display:none}.row.g-3[_ngcontent-%COMP%] > [class*=col-][_ngcontent-%COMP%]{margin-bottom:1rem}.was-validated[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:valid, .was-validated[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]:valid{border-color:#28a745}.was-validated[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:valid:focus, .was-validated[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]:valid:focus{border-color:#28a745;box-shadow:0 0 0 .2rem #28a74540}.form-control[_ngcontent-%COMP%]:hover:not(:focus):not(.is-invalid){border-color:#2d60ff}.form-select[_ngcontent-%COMP%]:hover:not(:focus):not(.is-invalid){border-color:#2d60ff}.phone-input-container[_ngcontent-%COMP%]{position:relative}.phone-hint[_ngcontent-%COMP%]{position:absolute;right:15px;top:50%;transform:translateY(-50%);color:#6c757d;font-size:.75rem;background-color:#fffc;padding:2px 8px;border-radius:10px}.form-check.form-switch[_ngcontent-%COMP%]{margin-bottom:1rem;padding-left:3rem}.form-check.form-switch[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]{margin-left:-3rem}']})}}return a})();export{oe as CreateNewUserComponent};
